language: cpp
matrix:
  include:
    - os: osx
      #env: DEPLOY_FILE=lib/libHMDecoder.dylib
compiler:
- gcc

install:
# Get the precompiled openssl libraries
- curl -L https://github.com/ChristianFeldmann/YUViewQt/releases/download/openSSL1.1.1/openSSL_1_1_1_stable_mac.zip -o openSSL.zip
- unzip -q -a openSSL.zip
# Get Qt into a folder in which we build it
- curl -L https://github.com/qt/qtbase/archive/v5.13.1.zip -o Qtbase.zip
- unzip -q -a Qtbase.zip
- mv qtbase-5.13.1 Qt_build

script:
# Build QtBase and install it to /Users/travis/build/Qt
- cd Qt_build
# Hack to enable qtsync although we did not technically checkout from git
- mkdir .git
- ./configure -release -opensource -confirm-license -prefix /Users/travis/build/Qt -openssl -I ${TRAVIS_BUILD_DIR}/openSSL/include/ -L ${TRAVIS_BUILD_DIR}/YUViewQt/openSSL/ -nomake examples
- make
- make install
- cd ..

before_deploy:
# Zip the Qt folder in /Users/travis/build/Qt. Write the zip file to 
- cd /Users/travis/build/
- zip --quiet -r ${TRAVIS_BUILD_DIR}/Qt-5.13.1_mac.zip Qt/bin Qt/lib Qt/include Qt/mkspecs Qt/plugins
- cd ${TRAVIS_BUILD_DIR}
- ls -l

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: kz5qfB8zuzBc7rm3u5aHB5oilKWhduGne731/7sNCgYk+QJ6ALrdgXBSwf9QQcvntUJqtm5R+LxK8ulplrfShlLXE5HR+hZDw4MEkrhYvfF4GPtV/YcxeBKYMKJXYmuBv7K22icCPXhcXnsYr8g8/eAyeUmhFL6dia2z2524NVNcLUKBjKo4U55Ann0dSfWb49xQw39oSjLNWBBICoKQsazRKLTC7uucryQO7eYSmb/jPfZ3G5O7/T4BQp85fkyC1xCH21jEypTeaMVzE/Ha0wb5JvC2wQc2YJwZqumqAbghksV5Ydi59/ZX2D2TqauCyu/dQP9fsP503sWZaxuBLgbaWT8pGmk3SaydX00yE/D0fYI99igQSvxACxP07QR6Uvc8Pi5YTQaLAWKa0JpZ3Np5pXEYCtBaTnQqNDNr6JgiQ9zGqXeCd7/ZghLfOLcYeWi1okqnlDk15RdhAKJIbX/CkVnYYG7xPrTwN3aksTQm9bsY4EbzgD8SVLWROqgs6bmUHlWOjKXT2ve+GWkfL41lOp8A1lCRaFtfjTVMD5f7xUzaaGIe+PD+g4CXoEMsa4Cqd7s6E8RoZZ/HN3427ybrH97nUtqoSorNM+Z3Ig5mDzOVUt64UxeWxTjKvN17iBPjQZV4XjFWtaSpdDsyBYTm/ihuegHhydACji857MU=
  file: Qt-5.13.1_mac.zip
  on:
    repo: ChristianFeldmann/YUViewQt
    tags: true